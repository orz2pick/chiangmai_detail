<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026Ê∏ÖËøàËØ¶ÁªÜË¥¶Âçï - Êô∫ËÉΩÂàÜÁ±ªÁâà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&family=Noto+Sans+SC:wght@300;500;900&display=swap');
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #f1f5f9;
            color: #1e293b;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .day-node {
            aspect-ratio: 1/1.1;
            border-radius: 12px;
            padding: 6px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 1px solid #e2e8f0;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        .day-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .day-node.active {
            border: 3px solid #4f46e5 !important;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .heat-0 { color: #94a3b8; }
        .heat-1 { background: #f0f9ff; color: #0369a1; }
        .heat-2 { background: #e0f2fe; color: #075985; }
        .heat-3 { background: #bae6fd; color: #0c4a6e; }
        .heat-4 { background: #fee2e2; color: #991b1b; }
        .heat-5 { background: #fecaca; color: #7f1d1d; }

        .category-group {
            transition: max-height 0.3s ease-out;
            overflow: hidden;
        }

        .category-card[data-open="true"] .category-items {
            display: block;
        }

        #pie-svg { transform: rotate(-90deg); transition: all 0.6s ease; }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-10" onclick="resetView()">
    <div class="max-w-5xl mx-auto" onclick="event.stopPropagation()">
        
        <!-- Top Summary -->
        <header class="mb-10 flex flex-col md:flex-row items-center justify-between gap-6 bg-white p-8 rounded-[40px] shadow-sm border border-slate-100">
            <div>
                <h1 class="text-4xl font-black text-slate-900 tracking-tighter italic">CHIANG MAI <span class="text-indigo-600">2026</span></h1>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-[0.3em] mt-2">Personal Travel Ledger</p>
            </div>
            <div class="flex items-center gap-8">
                <div class="text-right">
                    <p class="text-[10px] font-black text-slate-400 mb-2 uppercase">Current Spending</p>
                    <div class="flex items-center gap-4">
                        <span id="grand-total-thb" class="text-3xl font-black text-slate-900 mono">‡∏ø0</span>
                        <div class="h-8 w-[2px] bg-slate-100"></div>
                        <span id="grand-total-cny" class="text-3xl font-black text-indigo-600 mono">¬•0</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            
            <!-- Calendar Section -->
            <div class="lg:col-span-6">
                <div class="bg-white rounded-[40px] p-8 border border-slate-200 shadow-sm">
                    <div class="flex justify-between items-center mb-10">
                        <h2 class="text-2xl font-black text-slate-800">2Êúà <span class="text-slate-300 font-light italic">Feb</span></h2>
                        <span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-4 py-1.5 rounded-full">ÁÇπÂáªÊó•ÊúüÂ±ïÂºÄÂàÜÁ±ª</span>
                    </div>
                    
                    <div class="calendar-grid text-center text-[10px] font-black text-slate-300 mb-6 uppercase tracking-widest">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    
                    <div id="calendar-body" class="calendar-grid">
                        <!-- JS Injected -->
                    </div>
                </div>
            </div>

            <!-- Detail Section -->
            <div class="lg:col-span-6">
                <div id="info-panel" class="bg-white rounded-[40px] border border-slate-200 shadow-2xl overflow-hidden flex flex-col h-[800px]">
                    <!-- Header -->
                    <div id="panel-header" class="p-8 bg-slate-900 text-white transition-all duration-500">
                        <div class="flex justify-between items-start">
                            <h3 id="panel-date" class="text-2xl font-black italic">Ê±áÊÄªÊä•Ë°®</h3>
                            <div class="text-right">
                                <p id="panel-total-thb" class="text-2xl font-black mono">‡∏ø0</p>
                                <p id="panel-total-cny" class="text-2xl font-black mono text-indigo-400">¬•0</p>
                            </div>
                        </div>
                        <p id="panel-desc" class="text-[10px] opacity-60 font-bold mt-4 uppercase tracking-[0.2em]">Summary for all trip</p>
                    </div>

                    <!-- Chart -->
                    <div class="p-8 flex flex-col items-center bg-slate-50 border-b border-slate-100">
                        <div class="relative w-40 h-40">
                            <svg id="pie-svg" viewBox="0 0 100 100" class="w-full h-full"></svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="bg-white w-20 h-20 rounded-full shadow-inner flex flex-col items-center justify-center">
                                    <span class="text-[9px] font-black text-slate-400">ÊØî‰æã</span>
                                </div>
                            </div>
                        </div>
                        <div id="chart-legend" class="grid grid-cols-2 gap-x-8 gap-y-2 mt-8 text-[11px] font-black w-full"></div>
                    </div>

                    <!-- Items -->
                    <div id="items-list" class="flex-grow overflow-y-auto p-6 space-y-4 bg-white">
                        <!-- Categories and Items -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        const exchangeRate = 0.205; 
        const cats = {
            "È§êÈ•Æ": { icon: "üçú", color: "#f59e0b" },
            "‰∫§ÈÄö": { icon: "‚úàÔ∏è", color: "#3b82f6" },
            "Ë¥≠Áâ©": { icon: "üõçÔ∏è", color: "#10b981" },
            "Â®±‰πê": { icon: "üé≠", color: "#8b5cf6" },
            "ÈÄö‰ø°": { icon: "üì∂", color: "#06b6d4" },
            "ËøêÂä®": { icon: "üéæ", color: "#6366f1" },
            "‰ΩèÂÆø": { icon: "üè®", color: "#14b8a6" },
            "È•ÆÊñô": { icon: "ü•§", color: "#0ea5e9" },
            "Èõ∂È£ü": { icon: "ü•®", color: "#fb923c" },
            "Èó®Á•®": { icon: "üé´", color: "#ec4899" },
            "Êó•Áî®": { icon: "üß¥", color: "#64748b" },
            "Ê∞¥Êûú": { icon: "ü•≠", color: "#84cc16" },
            "ËçØÂìÅ": { icon: "üíä", color: "#ef4444" },
            "ÂÖ∂‰ªñ": { icon: "üì¶", color: "#94a3b8" }
        };

        const rawData = [
            { date: 11, title: "ÂàùÂÖ•Ê∏ÖËøà", items: [["ÁîµËØùÂç°", 399, "THB", "ÈÄö‰ø°"], ["ÊâìËΩ¶ Taxi", 180, "THB", "‰∫§ÈÄö"]] },
            { date: 12, title: "ÂàùÂà∞Ê∏ÖËøà", items: [["Êú∫Âú∫Êé•Êú∫/ÊâìËΩ¶", 466, "THB", "‰∫§ÈÄö"], ["Pizza My Heart", 830, "THB", "È§êÈ•Æ"], ["Poopoopaper", 120, "THB", "Ë¥≠Áâ©"], ["Soap for Soul", 670, "THB", "Ë¥≠Áâ©"], ["Beak Design", 952, "THB", "Ë¥≠Áâ©"], ["7-ElevenÊ±áÊÄª", 138, "THB", "Èõ∂È£ü"], ["Ê≥∞ÂºèÊåâÊë©", 600, "THB", "Â®±‰πê"], ["breakfast", 199, "THB", "È§êÈ•Æ"], ["ÂéªÁ®ãÊú∫Á•®Èí±", 2679 + 2770, "CNY", "‰∫§ÈÄö"]] },
            { date: 13, title: "ÂÖ∞Á∫≥ÊãçÁÖßÊó•", items: [["Êó©Êô®6ÁÇπÁΩëÁêÉËØæ", 700, "THB", "ËøêÂä®"], ["Êó©È•≠", 259, "THB", "È§êÈ•Æ"], ["ÊâìËΩ¶ÂéªLanna", 89, "THB", "‰∫§ÈÄö"], ["Ê§∞Â≠êÊ∞¥3Áì∂", 75, "THB", "È•ÆÊñô"], ["ÊãçÁÖßÊúçÂä°Ë¥π", 500, "CNY", "Â®±‰πê"], ["LannaÈó®Á•®", 300, "THB", "Èó®Á•®"], ["ÊâìËΩ¶ÂéªKaosoy", 104, "THB", "‰∫§ÈÄö"], ["Ê≥∞Ëå∂", 75, "THB", "È•ÆÊñô"], ["ÊôöÈ•≠", 540, "THB", "È§êÈ•Æ"], ["711Êä§ÂèëÊ≤πÁ≠â", 66.19, "CNY", "Êó•Áî®"], ["ÊâìËΩ¶Ê±áÊÄª", 222, "THB", "‰∫§ÈÄö"], ["711Ê∞¥+ËñØÁâá", 10.26, "CNY", "Èõ∂È£ü"], ["ÁéâÁ±≥", 10, "THB", "Èõ∂È£ü"]] },
            { date: 14, title: "Á´πÂ≠êÂ∏ÇÂú∫Ë¥≠Áâ©Êó•", items: [["Êó©Êô®6ÁÇπÁΩëÁêÉËØæ", 700, "THB", "ËøêÂä®"], ["ÊâìËΩ¶ÂéªÁêÉÂú∫", 81, "THB", "‰∫§ÈÄö"], ["ÊâìËΩ¶ÂéªÂ∏ÇÂú∫", 116, "THB", "‰∫§ÈÄö"], ["Ëç∑Âè∂ÂåÖ", 20, "THB", "È§êÈ•Æ"], ["Áå™ËÇâÁ≤•", 50, "THB", "È§êÈ•Æ"], ["Ê≤ôÊãâ", 55, "THB", "È§êÈ•Æ"], ["ÊûúÊ±Å", 50, "THB", "È•ÆÊñô"], ["Â∞èÊüøÂ≠ê", 50, "THB", "Ê∞¥Êûú"], ["ÊúâÊú∫ÁâõÂ•∂", 45, "THB", "È•ÆÊñô"], ["Èù¢ÂåÖ", 236, "THB", "È§êÈ•Æ"], ["Â∏É‰∏Å+ÈÖ∏Â•∂", 80, "THB", "Èõ∂È£ü"], ["Ë£ôÂ≠ê", 500, "THB", "Ë¥≠Áâ©"], ["Á¨îËÆ∞Êú¨", 280, "THB", "Ë¥≠Áâ©"], ["ÂíñÂï°", 170, "THB", "È•ÆÊñô"], ["Â∑ßÂÖãÂäõÈù¢ÂåÖ*2", 96, "THB", "Èõ∂È£ü"], ["ÂèåÊù°ËΩ¶", 140, "THB", "‰∫§ÈÄö"], ["Â•àÈ£û‰ºöÂëò", 12.7, "CNY", "Â®±‰πê"], ["Êë©ÁöÑ", 90, "THB", "‰∫§ÈÄö"], ["ÂêÉÈ•≠", 57.69, "CNY", "È§êÈ•Æ"], ["‰π∞Ë°£Êúç(ÊîØ‰ªòÂÆù)", 316, "CNY", "Ë¥≠Áâ©"], ["Èù¢ËÜú", 41, "CNY", "Êó•Áî®"], ["‰π∞Ë°£Êúç(Áé∞Èáë)", 780, "THB", "Ë¥≠Áâ©"], ["Ë∂ÖÂ∏ÇË¥≠Áâ©", 211.56, "CNY", "Ë¥≠Áâ©"], ["Ê¶¥Ëé≤", 87.65, "CNY", "Ê∞¥Êûú"], ["Á™ÅÁ™ÅËΩ¶", 250, "THB", "‰∫§ÈÄö"], ["Ê∞¥2Áì∂", 22, "THB", "È•ÆÊñô"], ["È©±Ëöä‰∏éÊ∫ÉÁñ°ËçØ", 51.43, "CNY", "ËçØÂìÅ"]] },
            { date: 15, title: "Ê≥∞È§êËØæÈ¢ÑÂÆö‰∏éÊ¶¥Ëé≤", items: [["Ê∞¥‰∏§Áì∂", 22, "THB", "È•ÆÊñô"], ["ÊâìËΩ¶ÂéªÂ°î‰Ω©Èó®", 108, "THB", "‰∫§ÈÄö"], ["ÊâìËΩ¶ÂõûÈÖíÂ∫ó", 83.22, "THB", "‰∫§ÈÄö"], ["ÁúºÈïúÂ∏É", 8.5, "THB", "Êó•Áî®"], ["Êó•ÊñôÊôöÈ§ê", 571, "THB", "È§êÈ•Æ"], ["Ê¶¥Ëé≤", 340, "THB", "Ê∞¥Êûú"], ["ËçâËéìÂÜ∞Ê∑áÊ∑ã", 99, "THB", "Èõ∂È£ü"], ["È¢ÑÂÆöÊ≥∞È§êËØæÁ®ã", 368.6, "CNY", "Â®±‰πê"]] },
            { date: 16, title: "MAYA Ë°•Áªô‰∏éÁ∫¢ÈÖí", items: [["ÂíñÂï°", 90, "THB", "È•ÆÊñô"], ["È©¨ÊùÄÈ∏°", 650, "THB", "Â®±‰πê"], ["Ê≥∞tea", 45, "THB", "È•ÆÊñô"], ["Á∫¢ÈÖí", 180, "THB", "È•ÆÊñô"], ["MAYAË∂ÖÂ∏Ç", 185.6, "CNY", "Ë¥≠Áâ©"], ["ËñØÊù°", 10.4, "CNY", "Èõ∂È£ü"], ["ËçØÂìÅ", 55.33, "CNY", "ËçØÂìÅ"], ["GrabÊâìËΩ¶", 62, "THB", "‰∫§ÈÄö"], ["‰∏§Áì∂Ê∞¥", 4.72, "CNY", "È•ÆÊñô"]] },
            { date: 17, title: "ÂÖ®Â§©ËøêÂä®‰∏éÁáïÁ™ù", items: [["Êó©Êô®6ÁÇπÁΩëÁêÉËØæ", 700, "THB", "ËøêÂä®"], ["ÁÉ§Áå™ËÇâÁâá", 5, "THB", "È§êÈ•Æ"], ["‰∏âÊòéÊ≤ª", 25, "THB", "È§êÈ•Æ"], ["Ë±ÜÊµÜ", 7, "THB", "È•ÆÊñô"], ["Ê§∞Â≠êÊ∞¥2Áì∂", 39, "THB", "È•ÆÊñô"], ["ÊâìËΩ¶Âà∞È§êÂéÖ", 56, "THB", "‰∫§ÈÄö"], ["ÂêÉÈ•≠", 750, "THB", "È§êÈ•Æ"], ["ÂÜ∞ÊøÄÂáå", 250, "THB", "Èõ∂È£ü"], ["ÊâìËΩ¶ÂõûÊù•", 10.95, "CNY", "‰∫§ÈÄö"], ["ÊâìËΩ¶ÂéªÁΩëÁêÉÂú∫", 84, "THB", "‰∫§ÈÄö"], ["ÁΩëÁêÉËØæ", 1100, "THB", "ËøêÂä®"], ["1Áì∂Ê∞¥", 10, "THB", "È•ÆÊñô"], ["ÊâìËΩ¶ÂêÉÁáïÁ™ù", 43, "THB", "‰∫§ÈÄö"], ["ÁáïÁ™ù", 80, "THB", "È§êÈ•Æ"], ["ÊâìËΩ¶ÂõûÈÖíÂ∫ó", 39, "THB", "‰∫§ÈÄö"], ["‰∏§Áì∂Ê∞¥", 22, "THB", "È•ÆÊñô"]] },
            { date: 18, title: "ÁΩëÁêÉËØæ‰∏éÁ≤æËá¥È§êÈ•Æ", items: [["Êó©Êô®6ÁÇπÁΩëÁêÉËØæ", 700, "THB", "ËøêÂä®"], ["ÊâìËΩ¶ÂéªÁêÉÂú∫", 98, "THB", "‰∫§ÈÄö"], ["ÊâìËΩ¶ÂéªNana Bakery", 70, "THB", "‰∫§ÈÄö"], ["Êó©È§ê", 744, "THB", "È§êÈ•Æ"], ["ÊâìËΩ¶ÂéªÈ§êÈ¶Ü", 77, "THB", "‰∫§ÈÄö"], ["ÂçàÈ•≠Kiew Kai Ka", 1394, "THB", "È§êÈ•Æ"], ["Êú®Â§¥ÂàÆÊùø", 55, "THB", "Ë¥≠Áâ©"], ["ÊâìËΩ¶ÂõûCafe", 31, "THB", "‰∫§ÈÄö"], ["ÊâìËΩ¶ÂéªÁΩëÁêÉ", 41, "THB", "‰∫§ÈÄö"], ["ÁΩëÁêÉËØæ", 900, "THB", "ËøêÂä®"], ["1Áì∂Ê∞¥", 10, "THB", "È•ÆÊñô"], ["ÊâìËΩ¶ÂêÉÁáïÁ™ù", 43, "THB", "‰∫§ÈÄö"], ["ÁáïÁ™ù", 80, "THB", "È§êÈ•Æ"], ["ÊâìËΩ¶ÂõûCafe", 39, "THB", "‰∫§ÈÄö"], ["‰∏§Áì∂Ê∞¥", 22, "THB", "È•ÆÊñô"]] },
            { date: 19, title: "ÁÄëÂ∏É„ÄÅË±°‰∏éÊåâÊë©", items: [["Á≤òÁ≤òÁÄëÂ∏É‰∏ÄÊó•Ê∏∏", 270.48, "CNY", "Â®±‰πê"], ["ÊâãÊú∫Ë¢ã+ÊüöÂ≠ê", 120, "THB", "Ë¥≠Áâ©"], ["ÊüöÂ≠ê+ËôæÁâá", 125, "THB", "Èõ∂È£ü"], ["Ë±™ÂçéÊåâÊë©", 4343.13, "THB", "Â®±‰πê"], ["‰π∞Ë°£Êúç", 990, "THB", "Ë¥≠Áâ©"], ["‰π∞Ë¢úÂ≠ê", 200, "THB", "Ë¥≠Áâ©"], ["ÊâìËΩ¶ÂéªÊä´Ëê®Â∫ó", 102, "THB", "‰∫§ÈÄö"], ["Êä´Ëê®", 990, "THB", "È§êÈ•Æ"], ["ÊâìËΩ¶ÂéªÁΩëÁêÉÂú∫", 58, "THB", "‰∫§ÈÄö"], ["ÁΩëÁêÉÂú∫ÁßüÁî®", 1110, "THB", "ËøêÂä®"], ["ÊâìËΩ¶ÂõûÈÖíÂ∫ó", 204, "THB", "‰∫§ÈÄö"], ["Ë•øÁìúÁ≠âÊ∞¥Êûú", 100, "THB", "Ê∞¥Êûú"]] },
            { date: 20, title: "ÁΩëÁêÉ‰∏éÊó•Â∏∏", items: [["Êó©Êô®6ÁÇπÁΩëÁêÉËØæ", 700, "THB", "ËøêÂä®"], ["ÊâìËΩ¶ÂéªÁΩëÁêÉÂú∫", 56, "THB", "‰∫§ÈÄö"], ["ÊâìËΩ¶ÂéªÂíñÂï°", 66, "THB", "‰∫§ÈÄö"], ["ÂíñÂï°", 100, "THB", "È•ÆÊñô"], ["Èù¢ÂåÖ", 165, "THB", "È§êÈ•Æ"], ["ÁâôËÜèÂíåÂâÉÈ°ªÂàÄ", 61, "THB", "Êó•Áî®"]] },
            { date: 21, title: "ËøêÂä®„ÄÅÂíñÂï°‰∏éË¥≠Áâ©", items: [
                ["ÊâìËΩ¶ÂéªÁΩëÁêÉÂú∫", 77, "THB", "‰∫§ÈÄö"],
                ["Êó©Êô®ÁΩëÁêÉËØæ", 700, "THB", "ËøêÂä®"],
                ["ÊâìËΩ¶ÂõûÊù•", 73, "THB", "‰∫§ÈÄö"],
                ["Êó©È•≠È∏°ËõãÂíåÈù¢ÂåÖ", 0, "THB", "È§êÈ•Æ"],
                ["ÊâìËΩ¶Êù•Âà∞konjohnÂíñÂï°Â∫ó", 124, "THB", "‰∫§ÈÄö"],
                ["ÂíñÂï°2ÊùØ", 110, "THB", "È•ÆÊñô"],
                ["ÊâìÁ¢éÊùØÂ≠ê", 50, "THB", "ÂÖ∂‰ªñ"],
                ["Caramel macchiato", 65, "THB", "È•ÆÊñô"],
                ["È©¨ÊùÄÈ∏°", 1990, "THB", "Â®±‰πê"],
                ["Áù°Áú†Âñ∑Èõæ", 250, "THB", "Êó•Áî®"],
                ["‰ø©Èõ™Á≥ï", 60, "THB", "Èõ∂È£ü"],
                ["Á¢ó", 200, "THB", "Ë¥≠Áâ©"],
                ["ÊâìËΩ¶Âéªmac cafe", 56, "THB", "‰∫§ÈÄö"],
                ["Bear‰∏ÄÁì∂", 69, "THB", "È•ÆÊñô"],
                ["ÊüöÂ≠ê*4+Ë•øÁìú*1", 100, "THB", "Ê∞¥Êûú"],
                ["ÊôöÈ•≠", 701, "THB", "È§êÈ•Æ"],
                ["Êñπ‰æøÈù¢ËñØÁâá", 36, "THB", "Èõ∂È£ü"],
                ["Â∏É‰∏Å", 20, "THB", "Èõ∂È£ü"]
            ]},
            { date: 22, title: "ÂΩíÁ®ãÁªìÁÆó", items: [
                ["ÂõûÁ®ãÊú∫Á•®", 5386, "CNY", "‰∫§ÈÄö"], 
                ["‰ΩèÂÆøÁªìÁÆó(21-22)", 1974.86, "CNY", "‰ΩèÂÆø"],
                ["ÊâìËΩ¶ÂéªÊú∫Âú∫", 253, "THB", "‰∫§ÈÄö"],
                ["‰∏§ÊùØÊæ≥ÁôΩ", 240, "THB", "È•ÆÊñô"],
                ["Â∞èËØ¥„ÄäThe Crimsons„Äã", 265, "THB", "Ë¥≠Áâ©"],
                ["Coconut Milk & Tomyum", 120, "THB", "ÂÖ∂‰ªñ"]
            ] }
        ];

        const processed = rawData.map(d => {
            const items = d.items.map(it => ({
                name: it[0], val: it[1], unit: it[2], cat: it[3],
                thb: it[2] === "THB" ? it[1] : it[1] / exchangeRate,
                cny: it[2] === "CNY" ? it[1] : it[1] * exchangeRate
            }));
            
            // Group by category
            const categories = {};
            items.forEach(it => {
                if(!categories[it.cat]) categories[it.cat] = { totalTHB: 0, items: [] };
                categories[it.cat].totalTHB += it.thb;
                categories[it.cat].items.push(it);
            });

            // Sort items inside categories
            Object.values(categories).forEach(c => c.items.sort((a,b)=>b.thb - a.thb));

            return {
                ...d,
                items,
                categories: Object.entries(categories)
                    .sort((a,b)=>b[1].totalTHB - a[1].totalTHB),
                totalTHB: items.reduce((acc, it) => acc + it.thb, 0)
            };
        });

        const grandTotalTHB = processed.reduce((acc, d) => acc + d.totalTHB, 0);

        function renderCalendar() {
            const body = document.getElementById('calendar-body');
            body.innerHTML = '';
            for (let i = 1; i <= 28; i++) {
                const dayData = processed.find(x => x.date === i);
                const node = document.createElement('div');
                const heat = dayData ? (dayData.totalTHB < 2000 ? 1 : dayData.totalTHB < 5000 ? 2 : dayData.totalTHB < 10000 ? 3 : dayData.totalTHB < 20000 ? 4 : 5) : 0;
                node.className = `day-node heat-${heat}`;
                node.innerHTML = `
                    <span class="text-[9px] font-black opacity-40 select-none">${i}</span>
                    ${dayData ? `
                        <div class="text-right">
                            <p class="text-[9px] font-black mono leading-none mb-0.5">‡∏ø${Math.round(dayData.totalTHB)}</p>
                            <p class="text-[8px] font-bold opacity-30 leading-none">¬•${Math.round(dayData.totalTHB * exchangeRate)}</p>
                        </div>
                    ` : ''}
                `;
                if(dayData) node.onclick = (e) => { e.stopPropagation(); updateDetail(i, node); };
                body.appendChild(node);
            }
            document.getElementById('grand-total-thb').innerText = `‡∏ø${Math.round(grandTotalTHB).toLocaleString()}`;
            document.getElementById('grand-total-cny').innerText = `¬•${Math.round(grandTotalTHB * exchangeRate).toLocaleString()}`;
        }

        function drawPie(stats) {
            const svg = document.getElementById('pie-svg');
            const legend = document.getElementById('chart-legend');
            svg.innerHTML = ''; legend.innerHTML = '';
            const total = Object.values(stats).reduce((a, b) => a + b, 0);
            let cumulative = 0;

            Object.entries(stats).sort((a,b)=>b[1]-a[1]).forEach(([cat, val]) => {
                const percent = val / total;
                const dashArray = `${percent * 251.2} 251.2`;
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                circle.setAttribute("cx", "50"); circle.setAttribute("cy", "50"); circle.setAttribute("r", "40");
                circle.setAttribute("fill", "transparent");
                circle.setAttribute("stroke", cats[cat]?.color || "#cbd5e1");
                circle.setAttribute("stroke-width", "12");
                circle.setAttribute("stroke-dasharray", dashArray);
                circle.setAttribute("stroke-dashoffset", -cumulative * 251.2);
                circle.setAttribute("stroke-linecap", "round");
                svg.appendChild(circle);

                legend.innerHTML += `
                    <div class="flex items-center gap-2 overflow-hidden">
                        <span class="w-2.5 h-2.5 rounded-full shrink-0" style="background:${cats[cat]?.color || "#cbd5e1"}"></span>
                        <span class="text-slate-500 truncate">${cat} ${Math.round(percent*100)}%</span>
                    </div>
                `;
                cumulative += percent;
            });
        }

        function toggleCategory(el) {
            const isOpen = el.getAttribute('data-open') === 'true';
            el.setAttribute('data-open', !isOpen);
            const items = el.querySelector('.category-items');
            items.classList.toggle('hidden');
            el.querySelector('.arrow').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
        }

        function updateDetail(date, el) {
            const data = date ? processed.find(x => x.date === date) : null;
            document.querySelectorAll('.day-node').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');

            const header = document.getElementById('panel-header');
            header.style.backgroundColor = el ? window.getComputedStyle(el).backgroundColor : "#0f172a";
            header.style.color = (data && data.totalTHB > 10000) ? '#fff' : (el ? '#0f172a' : '#fff');

            document.getElementById('panel-date').innerText = date ? `2Êúà${date}Êó•` : "ÂÖ®Ë°åÁ®ãÊÄªÁªì";
            document.getElementById('panel-desc').innerText = date ? data.title : "Summary for all days";
            document.getElementById('panel-total-thb').innerText = `‡∏ø${Math.round(data?.totalTHB || grandTotalTHB).toLocaleString()}`;
            document.getElementById('panel-total-cny').innerText = `¬•${Math.round((data?.totalTHB || grandTotalTHB) * exchangeRate).toLocaleString()}`;

            const list = document.getElementById('items-list');
            list.innerHTML = '';
            
            const catsToRender = data ? data.categories : (() => {
                const totalCats = {};
                processed.forEach(d => d.categories.forEach(([cat, val]) => {
                    if(!totalCats[cat]) totalCats[cat] = { totalTHB: 0, items: [] };
                    totalCats[cat].totalTHB += val.totalTHB;
                    totalCats[cat].items.push(...val.items);
                }));
                Object.values(totalCats).forEach(c => c.items.sort((a,b)=>b.thb - a.thb));
                return Object.entries(totalCats).sort((a,b)=>b[1].totalTHB - a[1].totalTHB);
            })();

            const statsForPie = {};
            catsToRender.forEach(([catName, catData]) => {
                statsForPie[catName] = catData.totalTHB;
                const catEl = document.createElement('div');
                catEl.className = "category-card bg-slate-50 border border-slate-200 rounded-3xl overflow-hidden cursor-pointer hover:border-indigo-300 transition-all";
                catEl.onclick = (e) => { e.stopPropagation(); toggleCategory(catEl); };
                
                catEl.innerHTML = `
                    <div class="p-5 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <span class="text-2xl">${cats[catName]?.icon || 'üì¶'}</span>
                            <div>
                                <h4 class="text-sm font-black text-slate-800">${catName}</h4>
                                <p class="text-[10px] text-slate-400 font-bold uppercase">${catData.items.length} Á¨îÊîØÂá∫</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <p class="text-sm font-black mono text-slate-900 leading-tight">‡∏ø${Math.round(catData.totalTHB).toLocaleString()}</p>
                                <p class="text-[10px] font-black mono text-indigo-500 leading-tight">¬•${Math.round(catData.totalTHB * exchangeRate).toLocaleString()}</p>
                            </div>
                            <svg class="arrow w-4 h-4 text-slate-300 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </div>
                    <div class="category-items hidden bg-white border-t border-slate-100 divide-y divide-slate-50">
                        ${catData.items.map(it => `
                            <div class="p-4 flex justify-between items-center bg-white/50">
                                <span class="text-xs font-bold text-slate-600">${it.name}</span>
                                <div class="text-right">
                                    <span class="text-xs font-bold mono block">‡∏ø${Math.round(it.thb)}</span>
                                    <span class="text-[9px] font-bold mono text-slate-300">¬•${Math.round(it.cny)}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                list.appendChild(catEl);
            });
            drawPie(statsForPie);
        }

        function resetView() { updateDetail(null, null); }
        window.onload = () => { renderCalendar(); resetView(); };
    </script>
</body>
</html>

