<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…è¿ˆæ—…è¡Œæ—¥å†è´¦å•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-cell { aspect-ratio: 1 / 1.2; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 0.6rem; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; position: relative; padding: 2px; }
        .day-cell:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .day-cell.active { border: 2px solid #2563eb !important; z-index: 5; }
        .progress-bg { height: 6px; background: #f1f5f9; border-radius: 99px; width: 100%; margin-top: 4px; }
        .progress-fill { height: 100%; border-radius: 99px; transition: width 0.6s ease; }
        .amount-thb { font-size: 0.65rem; font-weight: 800; line-height: 1.1; margin-top: 2px; }
        .amount-cny { font-size: 0.55rem; font-weight: 500; opacity: 0.9; line-height: 1.1; }
        .chart-container { position: relative; width: 200px; height: 200px; margin: 0 auto; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="p-4 md:p-8 bg-slate-50 min-h-screen" onclick="resetToMonthly(event)">
    <div class="max-w-xl mx-auto" onclick="event.stopPropagation()">
        <header class="text-center mb-6">
            <h1 class="text-2xl font-bold text-slate-800">æ¸…è¿ˆæ¶ˆè´¹åŒå¸çƒ­åŠ›å›¾</h1>
            <div id="header-total" class="mt-2 inline-block px-4 py-1.5 bg-slate-200/50 rounded-full text-sm font-medium text-slate-600">
                <!-- JS è®¡ç®—æœˆæ€»é¢ -->
            </div>
        </header>

        <!-- æ—¥å†éƒ¨åˆ† -->
        <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-200 mb-6">
            <div class="flex justify-between items-center mb-4 px-2">
                <span class="font-bold text-slate-700">2025å¹´ 2æœˆ</span>
                <div class="flex gap-2 text-[10px]">
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-100 border border-slate-200"></span>çœé’±</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span>çŒ›èŠ±</span>
                </div>
            </div>
            <div class="calendar-grid text-center text-[10px] font-bold text-slate-400 mb-2">
                <div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
            </div>
            <div id="calendar-days" class="calendar-grid">
                <!-- JS å¡«å…… -->
            </div>
        </div>

        <!-- æ±‡æ€»/è¯¦æƒ…åŒºåŸŸ -->
        <div id="info-panel" class="animate-fade">
            <div id="detail-header-bg" class="rounded-t-2xl p-5 text-white shadow-lg transition-colors duration-500">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 id="detail-date" class="text-2xl font-bold">2æœˆæ±‡æ€»</h2>
                        <p id="detail-title" class="text-white/80 text-sm mt-1">å…¨æœˆè¡Œç¨‹æ¦‚è§ˆ</p>
                    </div>
                    <div class="text-right">
                        <div id="detail-total-thb" class="text-2xl font-mono font-bold">0 à¸¿</div>
                        <div id="detail-total-cny" class="text-white/80 text-xs font-medium">çº¦ Â¥0</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-b-2xl shadow-sm border border-slate-200 border-t-0 overflow-hidden">
                <!-- ç»Ÿè®¡å›¾åŒº -->
                <div class="p-6 bg-slate-50/50 border-b border-slate-100 flex flex-col items-center">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">æ¶ˆè´¹æ„æˆæ¯”ä¾‹ (>15%æ˜¾ç¤ºæ ‡æ³¨)</h3>
                    <div id="pie-chart-box" class="flex flex-col items-center gap-4 w-full">
                        <div id="pie-canvas" class="chart-container"></div>
                        <div id="pie-legend" class="grid grid-cols-3 gap-x-4 gap-y-1 text-[10px] w-full max-w-sm px-4"></div>
                    </div>
                </div>
                
                <div id="detail-items" class="min-h-[100px]">
                    <!-- JS å¡«å……è¡Œ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const exchangeRate = 0.2237;
        const categories = {
            "é¤é¥®": { icon: "ğŸœ", color: "#fbbf24" },
            "äº¤é€š": { icon: "ğŸš•", color: "#60a5fa" },
            "è´­ç‰©": { icon: "ğŸ›ï¸", color: "#34d399" },
            "å¨±ä¹": { icon: "ğŸ­", color: "#a78bfa" },
            "æ—¥ç”¨": { icon: "ğŸ§´", color: "#f472b6" },
            "æ°´æœ": { icon: "ğŸŠ", color: "#fb923c" },
            "é›¶é£Ÿ": { icon: "ğŸª", color: "#f87171" },
            "é¥®æ–™": { icon: "ğŸ¥¤", color: "#22d3ee" },
            "è¯å“": { icon: "ğŸ’Š", color: "#94a3b8" },
            "è¿åŠ¨": { icon: "ğŸ¾", color: "#818cf8" },
            "é—¨ç¥¨": { icon: "ğŸ«", color: "#c084fc" },
            "ä½å®¿": { icon: "ğŸ¨", color: "#2dd4bf" },
            "å…¶ä»–": { icon: "ğŸ“¦", color: "#cbd5e1" }
        };

        const rawData = [
            { date: 12, title: "åˆåˆ°æ¸…è¿ˆ", items: [["æœºåœºæ¥æœº/æ‰“è½¦", 466, "THB", "äº¤é€š"], ["Pizza My Heart", 830, "THB", "é¤é¥®"], ["Poopoopaper", 120, "THB", "è´­ç‰©"], ["Soap for Soul", 670, "THB", "è´­ç‰©"], ["Beak Design", 952, "THB", "è´­ç‰©"], ["7-Elevenæ±‡æ€»", 138, "THB", "é›¶é£Ÿ"], ["æ³°å¼æŒ‰æ‘©", 600, "THB", "å¨±ä¹"]] },
            { date: 13, title: "å…°çº³æ‹ç…§æ—¥", items: [["æ—©æ™¨6ç‚¹ç½‘çƒè¯¾", 700, "THB", "è¿åŠ¨"], ["æ—©é¥­", 259, "THB", "é¤é¥®"], ["æ‰“è½¦å»Lanna", 89, "THB", "äº¤é€š"], ["æ¤°å­æ°´3ç“¶", 75, "THB", "é¥®æ–™"], ["æ‹ç…§æœåŠ¡è´¹", 500, "CNY", "å¨±ä¹"], ["Lannaé—¨ç¥¨", 300, "THB", "é—¨ç¥¨"], ["æ‰“è½¦å»Kaosoy", 104, "THB", "äº¤é€š"], ["æ³°èŒ¶", 75, "THB", "é¥®æ–™"], ["æ™šé¥­", 540, "THB", "é¤é¥®"], ["711æŠ¤å‘æ²¹ç­‰", 66.19, "CNY", "æ—¥ç”¨"], ["æ‰“è½¦æ±‡æ€»", 222, "THB", "äº¤é€š"], ["711æ°´+è–¯ç‰‡", 10.26, "CNY", "é›¶é£Ÿ"], ["ç‰ç±³", 10, "THB", "é›¶é£Ÿ"]] },
            { date: 14, title: "ç«¹å­å¸‚åœºè´­ç‰©æ—¥", items: [["æ—©æ™¨6ç‚¹ç½‘çƒè¯¾", 700, "THB", "è¿åŠ¨"], ["æ‰“è½¦å»çƒåœº", 81, "THB", "äº¤é€š"], ["æ‰“è½¦å»å¸‚åœº", 116, "THB", "äº¤é€š"], ["è·å¶åŒ…", 20, "THB", "é¤é¥®"], ["çŒªè‚‰ç²¥", 50, "THB", "é¤é¥®"], ["æ²™æ‹‰", 55, "THB", "é¤é¥®"], ["æœæ±", 50, "THB", "é¥®æ–™"], ["å°æŸ¿å­", 50, "THB", "æ°´æœ"], ["æœ‰æœºç‰›å¥¶", 45, "THB", "é¥®æ–™"], ["é¢åŒ…", 236, "THB", "é¤é¥®"], ["å¸ƒä¸+é…¸å¥¶", 80, "THB", "é›¶é£Ÿ"], ["è£™å­", 500, "THB", "è´­ç‰©"], ["ç¬”è®°æœ¬", 280, "THB", "è´­ç‰©"], ["å’–å•¡", 170, "THB", "é¥®æ–™"], ["å·§å…‹åŠ›é¢åŒ…*2", 96, "THB", "é›¶é£Ÿ"], ["åŒæ¡è½¦", 140, "THB", "äº¤é€š"], ["å¥ˆé£ä¼šå‘˜", 12.7, "CNY", "å¨±ä¹"], ["æ‘©çš„", 90, "THB", "äº¤é€š"], ["åƒé¥­", 57.69, "CNY", "é¤é¥®"], ["ä¹°è¡£æœ(æ”¯ä»˜å®)", 316, "CNY", "è´­ç‰©"], ["é¢è†œ", 41, "CNY", "æ—¥ç”¨"], ["ä¹°è¡£æœ(ç°é‡‘)", 780, "THB", "è´­ç‰©"], ["è¶…å¸‚è´­ç‰©", 211.56, "CNY", "è´­ç‰©"], ["æ¦´è²", 87.65, "CNY", "æ°´æœ"], ["çªçªè½¦", 250, "THB", "äº¤é€š"], ["æ°´2ç“¶", 22, "THB", "é¥®æ–™"], ["é©±èšŠä¸æºƒç–¡è¯", 51.43, "CNY", "è¯å“"]] },
            { date: 15, title: "æ³°é¤è¯¾é¢„å®šä¸æ¦´è²", items: [["æ°´ä¸¤ç“¶", 22, "THB", "é¥®æ–™"], ["æ‰“è½¦å»å¡”ä½©é—¨", 108, "THB", "äº¤é€š"], ["æ‰“è½¦å›é…’åº—", 83.22, "THB", "äº¤é€š"], ["çœ¼é•œå¸ƒ", 8.5, "THB", "æ—¥ç”¨"], ["æ—¥æ–™æ™šé¤", 571, "THB", "é¤é¥®"], ["æ¦´è²", 340, "THB", "æ°´æœ"], ["è‰è“å†°æ·‡æ·‹", 99, "THB", "é›¶é£Ÿ"], ["é¢„å®šæ³°é¤è¯¾ç¨‹", 368.6, "CNY", "å¨±ä¹"]] },
            { date: 16, title: "MAYA è¡¥ç»™ä¸çº¢é…’", items: [["å’–å•¡", 90, "THB", "é¥®æ–™"], ["é©¬æ€é¸¡", 650, "THB", "å¨±ä¹"], ["æ³°tea", 45, "THB", "é¥®æ–™"], ["çº¢é…’", 180, "THB", "é¥®æ–™"], ["MAYAè¶…å¸‚", 185.6, "CNY", "è´­ç‰©"], ["è–¯æ¡", 10.4, "CNY", "é›¶é£Ÿ"], ["è¯å“", 55.33, "CNY", "è¯å“"], ["Grabæ‰“è½¦", 62, "THB", "äº¤é€š"], ["ä¸¤ç“¶æ°´", 4.72, "CNY", "é¥®æ–™"]] },
            { date: 17, title: "å…¨å¤©è¿åŠ¨ä¸ç‡•çª", items: [["æ—©æ™¨6ç‚¹ç½‘çƒè¯¾", 700, "THB", "è¿åŠ¨"], ["çƒ¤çŒªè‚‰ç‰‡", 5, "THB", "é¤é¥®"], ["ä¸‰æ˜æ²»", 25, "THB", "é¤é¥®"], ["è±†æµ†", 7, "THB", "é¥®æ–™"], ["æ¤°å­æ°´2ç“¶", 39, "THB", "é¥®æ–™"], ["æ‰“è½¦åˆ°é¤å…", 56, "THB", "äº¤é€š"], ["åƒé¥­", 750, "THB", "é¤é¥®"], ["å†°æ¿€å‡Œ", 250, "THB", "é›¶é£Ÿ"], ["æ‰“è½¦å›æ¥", 10.95, "CNY", "äº¤é€š"], ["æ‰“è½¦å»ç½‘çƒåœº", 84, "THB", "äº¤é€š"], ["ç½‘çƒè¯¾", 1100, "THB", "è¿åŠ¨"], ["1ç“¶æ°´", 10, "THB", "é¥®æ–™"], ["æ‰“è½¦åƒç‡•çª", 43, "THB", "äº¤é€š"], ["ç‡•çª", 80, "THB", "é¤é¥®"], ["æ‰“è½¦å›é…’åº—", 39, "THB", "äº¤é€š"], ["ä¸¤ç“¶æ°´", 22, "THB", "é¥®æ–™"]] },
            { date: 18, title: "ç½‘çƒè¯¾ä¸ç²¾è‡´é¤é¥®", items: [["æ—©æ™¨6ç‚¹ç½‘çƒè¯¾", 700, "THB", "è¿åŠ¨"], ["æ‰“è½¦å»çƒåœº", 98, "THB", "äº¤é€š"], ["æ‰“è½¦å»Nana Bakery", 70, "THB", "äº¤é€š"], ["æ—©é¤", 744, "THB", "é¤é¥®"], ["æ‰“è½¦å»é¤é¦†", 77, "THB", "äº¤é€š"], ["åˆé¥­Kiew Kai Ka", 1394, "THB", "é¤é¥®"], ["æœ¨å¤´åˆ®æ¿", 55, "THB", "è´­ç‰©"], ["æ‰“è½¦å›Cafe", 31, "THB", "äº¤é€š"], ["æ‰“è½¦å»ç½‘çƒ", 41, "THB", "äº¤é€š"], ["ç½‘çƒè¯¾", 900, "THB", "è¿åŠ¨"], ["1ç“¶æ°´", 10, "THB", "é¥®æ–™"], ["æ‰“è½¦åƒç‡•çª", 43, "THB", "äº¤é€š"], ["ç‡•çª", 80, "THB", "é¤é¥®"], ["æ‰“è½¦å›Cafe", 39, "THB", "äº¤é€š"], ["ä¸¤ç“¶æ°´", 22, "THB", "é¥®æ–™"]] },
            { date: 19, title: "ç€‘å¸ƒã€è±¡ä¸æŒ‰æ‘©", items: [["ç²˜ç²˜ç€‘å¸ƒä¸€æ—¥æ¸¸", 270.48, "CNY", "å¨±ä¹"], ["æ‰‹æœºè¢‹+æŸšå­", 120, "THB", "è´­ç‰©"], ["æŸšå­+è™¾ç‰‡", 125, "THB", "é›¶é£Ÿ"], ["è±ªåæŒ‰æ‘©", 4343.13, "THB", "å¨±ä¹"], ["ä¹°è¡£æœ", 990, "THB", "è´­ç‰©"], ["ä¹°è¢œå­", 200, "THB", "è´­ç‰©"], ["æ‰“è½¦å»æŠ«è¨åº—", 102, "THB", "äº¤é€š"], ["æŠ«è¨", 990, "THB", "é¤é¥®"], ["æ‰“è½¦å»ç½‘çƒåœº", 58, "THB", "äº¤é€š"], ["ç½‘çƒåœºç§Ÿç”¨", 1110, "THB", "è¿åŠ¨"], ["æ‰“è½¦å›é…’åº—", 204, "THB", "äº¤é€š"], ["è¥¿ç“œç­‰æ°´æœ", 100, "THB", "æ°´æœ"]] },
            { date: 20, title: "ç½‘çƒä¸æ—¥å¸¸", items: [["æ—©æ™¨6ç‚¹ç½‘çƒè¯¾", 700, "THB", "è¿åŠ¨"], ["æ‰“è½¦å»ç½‘çƒåœº", 56, "THB", "äº¤é€š"], ["æ‰“è½¦å»å’–å•¡", 66, "THB", "äº¤é€š"], ["å’–å•¡", 100, "THB", "é¥®æ–™"], ["é¢åŒ…", 165, "THB", "é¤é¥®"], ["ç‰™è†å’Œå‰ƒé¡»åˆ€", 61, "THB", "æ—¥ç”¨"]] },
            { date: 21, title: "è¿”ç¨‹ç½‘çƒè¯¾", items: [["æ—©æ™¨6ç‚¹ç½‘çƒè¯¾", 700, "THB", "è¿åŠ¨"]] }
        ];

        const processedData = rawData.map(day => {
            const totalTHB = day.items.reduce((sum, item) => {
                const [_, val, unit] = item;
                return sum + (unit === "THB" ? val : val / exchangeRate);
            }, 0);
            return { ...day, totalTHB };
        });

        const monthTotalTHB = processedData.reduce((s, d) => s + d.totalTHB, 0);

        function getHeatColor(total) {
            if (total === 0) return '#f8fafc';
            if (total < 1000) return '#dbeafe';
            if (total < 2500) return '#93c5fd';
            if (total < 5000) return '#fca5a5';
            if (total < 8000) return '#ef4444';
            return '#b91c1c';
        }

        const calendarContainer = document.getElementById('calendar-days');
        const headerTotal = document.getElementById('header-total');

        function renderCalendar() {
            headerTotal.innerHTML = `2æœˆå…±è®¡ï¼š<span class="text-slate-900 font-bold">${Math.round(monthTotalTHB).toLocaleString()} à¸¿</span> / <span class="text-slate-900 font-bold">Â¥${Math.round(monthTotalTHB * exchangeRate).toLocaleString()}</span>`;
            
            const firstDayOffset = 6;
            const daysInMonth = 28;
            for (let i = 0; i < firstDayOffset; i++) calendarContainer.appendChild(document.createElement('div'));

            for (let d = 1; d <= daysInMonth; d++) {
                const cell = document.createElement('div');
                cell.className = 'day-cell bg-slate-100 text-slate-300';
                const dayData = processedData.find(x => x.date === d);
                if (dayData) {
                    const textColor = dayData.totalTHB > 5000 ? '#ffffff' : (dayData.totalTHB > 0 ? '#1e3a8a' : '#cbd5e1');
                    cell.style.backgroundColor = getHeatColor(dayData.totalTHB);
                    cell.style.color = textColor;
                    cell.className = 'day-cell font-bold shadow-sm';
                    cell.innerHTML = `
                        <span class="text-[9px] opacity-60 absolute top-1 left-1.5">${d}</span>
                        <span class="amount-thb">à¸¿${Math.round(dayData.totalTHB)}</span>
                        <span class="amount-cny">Â¥${Math.round(dayData.totalTHB * exchangeRate)}</span>
                    `;
                    cell.onclick = (e) => { e.stopPropagation(); showDetail(d, e.currentTarget); };
                } else {
                    cell.innerHTML = `<span class="text-[9px] absolute top-1 left-1.5 opacity-40">${d}</span>`;
                }
                calendarContainer.appendChild(cell);
            }
        }

        function drawPieChart(dataMap) {
            const canvas = document.getElementById('pie-canvas');
            const legend = document.getElementById('pie-legend');
            canvas.innerHTML = "";
            legend.innerHTML = "";

            const total = Object.values(dataMap).reduce((a, b) => a + b, 0);
            if (total === 0) return;

            const size = 200;
            const radius = 80;
            const center = size / 2;
            let cumulativePercent = 0;

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", `0 0 ${size} ${size}`);
            svg.setAttribute("class", "w-full h-full");
            
            Object.entries(dataMap).forEach(([cat, val]) => {
                const percent = val / total;
                const startX = center + radius * Math.cos(2 * Math.PI * cumulativePercent - Math.PI/2);
                const startY = center + radius * Math.sin(2 * Math.PI * cumulativePercent - Math.PI/2);
                
                // è®¡ç®—æ ‡æ³¨ä½ç½® (æ‰‡å½¢ä¸­é—´)
                const labelAngle = 2 * Math.PI * (cumulativePercent + percent / 2) - Math.PI/2;
                const labelX = center + (radius * 0.65) * Math.cos(labelAngle);
                const labelY = center + (radius * 0.65) * Math.sin(labelAngle);

                cumulativePercent += percent;
                
                const endX = center + radius * Math.cos(2 * Math.PI * cumulativePercent - Math.PI/2);
                const endY = center + radius * Math.sin(2 * Math.PI * cumulativePercent - Math.PI/2);
                const largeArcFlag = percent > 0.5 ? 1 : 0;

                const pathData = `M ${center} ${center} L ${startX} ${startY} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${endX} ${endY} Z`;
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("d", pathData);
                path.setAttribute("fill", categories[cat]?.color || "#ccc");
                path.setAttribute("stroke", "#fff");
                path.setAttribute("stroke-width", "1.5");
                svg.appendChild(path);

                // åªæœ‰å¤§äº 15% æ‰æ˜¾ç¤ºæ–‡å­—æ ‡æ³¨
                if (percent > 0.15) {
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", labelX);
                    text.setAttribute("y", labelY);
                    text.setAttribute("fill", "#000");
                    text.setAttribute("font-size", "10px");
                    text.setAttribute("font-weight", "bold");
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("dominant-baseline", "middle");
                    text.textContent = cat;
                    svg.appendChild(text);
                }

                legend.innerHTML += `
                    <div class="flex items-center gap-1 mb-1">
                        <span class="w-2 h-2 rounded-full shrink-0" style="background-color: ${categories[cat]?.color}"></span>
                        <span class="truncate">${cat}: ${Math.round(percent * 100)}%</span>
                    </div>
                `;
            });
            canvas.appendChild(svg);
        }

        function showDetail(dateNum, element) {
            const day = processedData.find(x => x.date === dateNum);
            if (!day) return;

            document.querySelectorAll('.day-cell').forEach(c => c.classList.remove('active'));
            if(element) element.classList.add('active');

            const headerBg = document.getElementById('detail-header-bg');
            headerBg.style.backgroundColor = getHeatColor(day.totalTHB);
            headerBg.style.color = day.totalTHB > 5000 ? '#ffffff' : '#1e3a8a';

            document.getElementById('detail-date').innerText = `2æœˆ${dateNum}æ—¥`;
            document.getElementById('detail-title').innerText = day.title;
            document.getElementById('detail-total-thb').innerText = `${Math.round(day.totalTHB).toLocaleString()} à¸¿`;
            document.getElementById('detail-total-cny').innerText = `çº¦ Â¥${Math.round(day.totalTHB * exchangeRate)}`;

            const itemsContainer = document.getElementById('detail-items');
            const catStats = {};

            itemsContainer.innerHTML = day.items.map(item => {
                const [name, val, unit, cat] = item;
                const thbVal = unit === "THB" ? val : val / exchangeRate;
                const cnyVal = unit === "CNY" ? val : val * exchangeRate;
                const pct = ((thbVal / day.totalTHB) * 100).toFixed(1);
                catStats[cat] = (catStats[cat] || 0) + thbVal;

                return `
                    <div class="px-4 py-3 border-b border-slate-50 last:border-0">
                        <div class="flex justify-between items-start mb-1">
                            <div class="flex gap-3">
                                <span class="text-xl shrink-0">${categories[cat]?.icon || 'ğŸ’°'}</span>
                                <div><p class="text-sm font-bold text-slate-700">${name}</p><p class="text-[10px] text-slate-400">${cat} Â· ${pct}%</p></div>
                            </div>
                            <div class="text-right"><p class="text-sm font-bold text-slate-800">à¸¿${Math.round(thbVal)}</p><p class="text-[10px] text-slate-400">Â¥${cnyVal.toFixed(1)}</p></div>
                        </div>
                        <div class="progress-bg"><div class="progress-fill shadow-sm" style="width: ${pct}%; background-color: ${categories[cat]?.color}"></div></div>
                    </div>
                `;
            }).join('');
            drawPieChart(catStats);
        }

        function resetToMonthly(e) {
            document.querySelectorAll('.day-cell').forEach(c => c.classList.remove('active'));
            const headerBg = document.getElementById('detail-header-bg');
            headerBg.style.backgroundColor = "#475569";
            headerBg.style.color = "#ffffff";

            document.getElementById('detail-date').innerText = `2æœˆæ±‡æ€»`;
            document.getElementById('detail-title').innerText = "å…¨æœˆè¡Œç¨‹æ¶ˆè´¹åˆ†å¸ƒ";
            document.getElementById('detail-total-thb').innerText = `${Math.round(monthTotalTHB).toLocaleString()} à¸¿`;
            document.getElementById('detail-total-cny').innerText = `çº¦ Â¥${Math.round(monthTotalTHB * exchangeRate).toLocaleString()}`;

            const catStats = {};
            processedData.forEach(d => d.items.forEach(it => {
                const [_, val, unit, cat] = it;
                catStats[cat] = (catStats[cat] || 0) + (unit === "THB" ? val : val / exchangeRate);
            }));

            drawPieChart(catStats);
            document.getElementById('detail-items').innerHTML = `<div class="p-8 text-center text-slate-400 text-sm italic">ç‚¹å‡»æ—¥å†æŸ¥çœ‹å•æ—¥æ˜ç»†ï¼Œç‚¹å‡»å¤–éƒ¨å›åˆ°æ±‡æ€»</div>`;
        }

        window.onload = () => {
            renderCalendar();
            resetToMonthly();
        };
    </script>
</body>
</html>